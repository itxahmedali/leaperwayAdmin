{"version":3,"file":"ngx-editor-commands.js","sources":["../../../src/commands/removeLink.ts","../../../src/commands/applyMark.ts","../../../src/commands/ngx-editor-commands.ts"],"sourcesContent":["import { EditorState, Transaction } from 'prosemirror-state';\n\nexport const removeLink = () => {\n  return (state: EditorState, dispatch?: (tr: Transaction) => void): boolean => {\n    const { doc, selection, tr } = state;\n    const { $head: { pos }, from, to } = selection;\n\n    // if the cursor is on the link without any selection\n    if (from === to) {\n      const $pos = doc.resolve(pos);\n      const linkStart = pos - $pos.textOffset;\n      const linkEnd = linkStart + $pos.parent.child($pos.index()).nodeSize;\n\n      tr.removeMark(linkStart, linkEnd);\n    } else {\n      tr.removeMark(from, to);\n    }\n\n    if (!tr.docChanged) {\n      return false;\n    }\n\n    dispatch?.(tr);\n    return true;\n  };\n};\n\nexport default removeLink;\n","import { MarkType, Node as PrmosemirroNode } from 'prosemirror-model';\nimport { EditorState, SelectionRange, TextSelection, Transaction } from 'prosemirror-state';\n\n// Ref: https://github.com/ProseMirror/prosemirror-commands/blob/master/src/commands.js\n\nfunction markApplies(doc: PrmosemirroNode, ranges: SelectionRange[], type: MarkType): boolean {\n  for (const range of ranges) {\n    const { $from, $to } = range;\n\n    let canApply = $from.depth === 0 ? doc.type.allowsMarkType(type) : false;\n\n    doc.nodesBetween($from.pos, $to.pos, (node: PrmosemirroNode): boolean => {\n      if (canApply) {\n        return false;\n      }\n\n      canApply = node.inlineContent && node.type.allowsMarkType(type);\n      return true;\n    });\n\n    if (canApply) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport const applyMark = (type: MarkType, attrs: Record<string, any> = {}) => {\n  return (state: EditorState, dispatch?: (tr: Transaction) => void): boolean => {\n    const { tr, selection } = state;\n    const { $from, $to, empty, ranges } = selection;\n\n    if (empty && selection instanceof TextSelection) {\n      const { $cursor } = selection;\n\n      if (!$cursor || !markApplies(state.doc, ranges, type)) {\n        return false;\n      }\n\n      tr.addStoredMark(type.create(attrs));\n      dispatch?.(tr);\n    } else {\n      tr.addMark($from.pos, $to.pos, type.create(attrs));\n\n      if (!tr.docChanged) {\n        return false;\n      }\n      dispatch?.(tr.scrollIntoView());\n    }\n\n    return true;\n  };\n};\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}